<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Docker Compose · govueapp</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Docker Compose"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Docker Compose · govueapp"/><meta property="og:type" content="website"/><meta property="og:url" content="https://josephspurrier.github.io/govueapp/"/><meta property="og:description" content="## Docker Compose"/><meta property="og:image" content="https://josephspurrier.github.io/govueapp/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://josephspurrier.github.io/govueapp/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/govueapp/undefined"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/agate.min.css"/><link rel="alternate" type="application/atom+xml" href="https://josephspurrier.github.io/govueapp/blog/atom.xml" title="govueapp Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://josephspurrier.github.io/govueapp/blog/feed.xml" title="govueapp Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-161449546-1', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/govueapp/js/scrollSpy.js"></script><link rel="stylesheet" href="/govueapp/css/main.css"/><script src="/govueapp/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/govueapp/"><h2 class="headerTitle">govueapp</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/govueapp/docs/tutorial/run-locally" target="_self">Getting Started</a></li><li class="siteNavGroupActive"><a href="/govueapp/docs/wip" target="_self">Docs</a></li><li class=""><a href="/govueapp/blog/" target="_self">Blog</a></li><li class=""><a href="https://petstore.swagger.io/?url=https://raw.githubusercontent.com/josephspurrier/govueapp/master/src/app/api/static/swagger/swagger.json" target="_self">API</a></li><li class=""><a href="/govueapp/help" target="_self">Help</a></li><li class=""><a href="http://github.com/josephspurrier/govueapp" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Guides</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Getting Started</h3><ul class=""><li class="navListItem"><a class="navItem" href="/govueapp/docs/tutorial/run-locally">Run Locally</a></li><li class="navListItem"><a class="navItem" href="/govueapp/docs/tutorial/env-prep">Environment Prep</a></li><li class="navListItem"><a class="navItem" href="/govueapp/docs/tutorial/style-guide">Style Guide</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Guides</h3><ul class=""><li class="navListItem"><a class="navItem" href="/govueapp/docs/wip">Welcome</a></li><li class="navListItem"><a class="navItem" href="/govueapp/docs/database">Database</a></li><li class="navListItem"><a class="navItem" href="/govueapp/docs/front-end">Front-End</a></li><li class="navListItem"><a class="navItem" href="/govueapp/docs/back-end">Back-End</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/govueapp/docs/docker-compose">Docker Compose</a></li><li class="navListItem"><a class="navItem" href="/govueapp/docs/documentation">Documentation</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Docker Compose</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="docker-compose"></a><a href="#docker-compose" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker Compose</h2>
<p><a href="https://docs.docker.com/compose/">Compose</a> is a tool that helps you easily run multi-container Docker applications. The configuration is defined using a YAML file and you have control over different aspects of the containers like mountpoints, networks, and environment variables.</p>
<p>The configuration is defined in the <a href="https://github.com/josephspurrier/govueapp/blob/master/docker-compose.yml">docker-compose.yml</a> file.</p>
<h3><a class="anchor" aria-hidden="true" id="version"></a><a href="#version" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Version</h3>
<p>The version of the configuration is the at the top of the document. We chose <a href="https://docs.docker.com/compose/compose-file/compose-versioning/#version-34">3.4</a> because it's the first version where extension fields are support - they allow us to reuse configuration fragments which is covered in the next section. Version 3.4 only supports Docker Engine version 17.09.0 and higher.</p>
<h3><a class="anchor" aria-hidden="true" id="templates"></a><a href="#templates" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Templates</h3>
<p>This configuration fragment is essentially a template that we'll use for all of our services. This helps reduce typing and allows us to centralize all of our configurations. We'll define a few fields:</p>
<ul>
<li><code>restart: always</code> - this ensures the containers will restarted if they stop</li>
<li><code>env_file</code> - this tells docker that we want to load the <code>.env</code> for all the containers and set them as environment variables</li>
<li><code>networks</code> - this defines the network <code>dnet</code> that all the services will connect to so they can communicate</li>
</ul>
<p>We are using the <a href="https://github.com/josephspurrier/govueapp/blob/master/.env">.env</a> file for two purposes:</p>
<ul>
<li><a href="https://docs.docker.com/compose/env-file/">declaring default environment variables</a> for the docker-compose.yml file</li>
<li><a href="https://docs.docker.com/compose/environment-variables/">declaring environment variables</a> for each of the services (containers)</li>
</ul>
<p>By default, Compose will pull the variables from the <strong>.env</strong> file if it's in the current directory. We also pass it to the services so the containers can reference the environment variables as well.</p>
<h4><a class="anchor" aria-hidden="true" id="makefile"></a><a href="#makefile" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Makefile</h4>
<p>As an added benefit, at the top of the <a href="https://github.com/josephspurrier/govueapp/blob/master/Makefile">Makefile</a>, we also load in the same environment variables from the <strong>.env</strong> file so we can share them across our local environment and our container environments. Now we only have to define our variables in a single place and we can use the variables across all of our files. Here is what is at the top of the <strong>Makefile</strong>:</p>
<pre><code class="hljs css language-bash"><span class="hljs-comment"># Load the shared environment variables (shared with docker-compose.yml).</span>
include <span class="hljs-variable">${GOPATH}</span>/.env
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="networks"></a><a href="#networks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Networks</h3>
<p>By default, a network is created for all the containers so they can communicate. To support more complex topologies and because it's <a href="https://docs.docker.com/network/bridge/">superior to the default network</a>, we'll define the <a href="https://docs.docker.com/compose/networking/">network</a> and use the <code>bridge</code> driver. We'll call the network, <code>dnet</code>, which we chose to stand for &quot;docker network&quot;.</p>
<h3><a class="anchor" aria-hidden="true" id="services"></a><a href="#services" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Services</h3>
<p>The services define which images are used to spin up containers for them. The images are all built using the <a href="https://github.com/josephspurrier/govueapp/blob/master/bash/build-images.sh">build-images.sh</a> bash file. Again - notice the <strong>.env</strong> file is sourced before building the docker images.</p>
<p>We have four services defined:</p>
<ul>
<li><code>ingress</code> - this is a Go proxy that routes traffic that requests any URL to <code>/api</code> to the <code>api</code> container and any other requests to the <code>ui</code> container. The code for the ingress is <a href="https://github.com/josephspurrier/govueapp/blob/master/src/app/ingress/main.go">here</a> with the respective <a href="https://github.com/josephspurrier/govueapp/blob/master/src/app/ingress/Dockerfile">Dockerfile</a>.</li>
<li><code>db</code> - this is the MySQL database. It's using the standard <a href="https://hub.docker.com/_/mysql">mysql:5.7</a> Dockerfile.</li>
<li><code>ui</code> - this is the UI written in Vue.js and Nuxt.js. The code for the UI is <a href="https://github.com/josephspurrier/govueapp/tree/master/src/app/ui">here</a> with the respective <a href="https://github.com/josephspurrier/govueapp/tree/master/src/app/ui/Dockerfile">Dockerfile</a>.</li>
<li><code>api</code> - this is the Go API. The code for the API is <a href="https://github.com/josephspurrier/govueapp/tree/master/src/app/api">here</a> with the respective <a href="https://github.com/josephspurrier/govueapp/tree/master/src/app/api/Dockerfile">Dockerfile</a>.</li>
</ul>
<p>Notice only the <code>ports</code> for the ingress and db containers are exposed - this is because the requests for the api and ui are proxied through the ingress so there is no reason to expose them. The benefit of the ingress (reverse-proxy) is to allow you to use a single URL, a single port, and a single SSL certification for the application in the future even though the ui and api are listening on different ports internally.</p>
<p>Also notice the <code>service-template</code> is set at the top of each service - this uses the template defined at the top of the file to set defaults. Any of the values in the template can be overwritten if needed below it in the service.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/govueapp/docs/back-end"><span class="arrow-prev">← </span><span>Back-End</span></a><a class="docs-next button" href="/govueapp/docs/documentation"><span>Documentation</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#docker-compose">Docker Compose</a><ul class="toc-headings"><li><a href="#version">Version</a></li><li><a href="#templates">Templates</a></li><li><a href="#networks">Networks</a></li><li><a href="#services">Services</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/govueapp/" class="nav-home"></a><div><h5>Docs</h5><a href="/govueapp/docs/en/tutorial/run-locally.html">Getting Started</a><a href="/govueapp/docs/en/wip.html">Guides</a><a href="https://petstore.swagger.io/?url=https://raw.githubusercontent.com/josephspurrier/govueapp/master/src/app/api/static/swagger/swagger.json">API Reference</a></div><div><h5>Community</h5><a href="https://github.com/josephspurrier/govueapp/issues" target="_blank" rel="noreferrer noopener">GitHub Issues/Requests</a></div><div><h5>More</h5><a href="/govueapp/blog">Blog</a><a href="https://github.com/josephspurrier/govueapp">GitHub</a><a class="github-button" href="https://github.com/josephspurrier/govueapp" data-icon="octicon-star" data-count-href="/josephspurrier/govueapp/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><section class="copyright">Copyright © 2020 Joseph Spurrier</section></footer></div></body></html>